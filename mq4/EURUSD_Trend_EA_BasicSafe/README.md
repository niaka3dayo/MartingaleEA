# EURUSD_Trend_EA_BasicSafe - FX自動売買EA

## 概要

**EURUSD_Trend_EA_BasicSafe**は、EURUSD専用のトレンドフォロー型MT4自動売買EAです。
EMA、RSI、ADX、MACDなど複数のテクニカル指標を用いてトレンドを分析し、
資金管理、トレーリングストップ、時間フィルターなどの基本的なリスク管理機能を備えた、
実運用に耐えうる安全設計となっています。

※本EAは、過去にマーチンゲール戦略を採用したEA（MartingaleEA）もプロジェクト内に含まれていましたが、
安全性を最重視するため本実装（EURUSD_Trend_EA_BasicSafe）では採用していません。

---

## 特徴

- **テクニカル指標によるトレンド分析**
  複数の指標（EMA、RSI、ADX、MACD）の値をもとにスコアを算出し、エントリーポイントを判断します。

- **基本的な資金管理機能**
  リスク率（RiskPercent）に基づいてロットサイズを動的に計算します。
  ※`UseMoneyManagement`が`true`の場合に有効です。

- **トレーリングストップによる利益保護**
  指定したポイントに達した場合に自動的にストップロスを調整します。

- **時間フィルター**
  取引可能な時間帯（例：8時～20時）や曜日（例：金曜日の取引除外または金曜クローズ）に対応。

- **ECNブローカー対応**
  ブローカーの仕様に合わせ、初回発注時はSL/TPなしで建玉後、OrderModifyで設定します。

- **追加フィルター（オプション）**
  - **ボラティリティフィルター**
    ATR（Average True Range）を用いて市場のボラティリティを判定し、高ボラまたは低ボラの場合の取引を回避できます。
    ※また、ATRに基づいてスリッページやロットサイズを動的に調整する機能も搭載（初期状態はオフ）。
  - **ニュースフィルター**
    重要経済指標の発表時刻（手動指定）前後の取引を回避します。
    ※デフォルトではオフです。
  - **マルチタイムフレーム分析**
    補助の上位時間足（例：H4）でのトレンド分析を追加し、シグナルの信頼性を向上させます。
    ※初期状態はオフ。
  - **強化リスク管理**
    1日の最大損失、1日の取引回数、連続損失回数などにより、過剰なリスクを回避します。
    ※初期状態はオフ。

---

## 設定項目の詳細

### 1. トレード設定

| パラメーター              | 説明                                                           | 初期値   |
|--------------------------|--------------------------------------------------------------|---------|
| **InitialLotSize**       | 初期ロットサイズ。新規エントリー時の基本ロット数。              | 0.1     |
| **MaxLotSize**           | 最大ロットサイズ。資金管理で計算されたロットがこれを超えないように。   | 5.0     |
| **UseMoneyManagement**   | 資金管理機能を使用するか（trueならリスク率に基づくロット計算を行う）。  | true    |
| **RiskPercent**          | 口座資金に対するリスク率（％）。                                 | 2.0     |
| **StopLoss**             | ストップロスの幅（ポイント）。                                  | 50      |
| **TakeProfit**           | 利益確定の幅（ポイント）。                                    | 100     |
| **TrailingStop**         | トレーリングストップの開始幅（ポイント）。                      | 30      |
| **Slippage**             | 許容するスリッページ（ポイント）。                              | 3       |
| **MaxSpread**            | 最大許容スプレッド（ポイント）。                                | 5       |

### 2. 時間設定

| パラメーター        | 説明                                               | 初期値 |
|--------------------|--------------------------------------------------|-------|
| **UseTimeFilter**  | 時間フィルターを有効にするか。                          | true  |
| **StartHour**      | 取引開始時刻（時）。                                  | 8     |
| **EndHour**        | 取引終了時刻（時）。                                  | 20    |
| **MondayFilter**   | 月曜日の取引を回避するか。                             | false |
| **FridayFilter**   | 金曜日の取引を回避するか。                             | true  |
| **CloseAllFriday** | 金曜日の指定時刻に全ポジションを自動クローズするか。             | true  |
| **FridayCloseHour**| 金曜日の自動クローズ時刻（時）。                         | 20    |

### 3. トレンド判定設定

| パラメーター         | 説明                                              | 初期値 |
|---------------------|-------------------------------------------------|-------|
| **FastEMA**         | 短期EMAの期間。                                      | 8     |
| **SlowEMA**         | 長期EMAの期間。                                      | 21    |
| **RSI_Period**      | RSIの計算期間。                                     | 14    |
| **RSI_UpperLevel**  | RSIの上限値。                                      | 70    |
| **RSI_LowerLevel**  | RSIの下限値。                                      | 30    |
| **ADX_Period**      | ADXの計算期間。                                     | 14    |
| **ADX_MinLevel**    | ADXがトレンドとみなす最小レベル。                        | 25    |
| **MACD_FastEMA**    | MACDの短期EMA期間。                                  | 12    |
| **MACD_SlowEMA**    | MACDの長期EMA期間。                                  | 26    |
| **MACD_SignalPeriod** | MACDシグナルの期間。                                 | 9     |

### 4. その他の設定

| パラメーター              | 説明                                                     | 初期値    |
|--------------------------|--------------------------------------------------------|----------|
| **MagicNumber**          | EA識別用のマジックナンバー。                                | 20240601 |
| **EnableDebugLog**       | デバッグログの出力を有効にするか。                            | false    |
| **SendPushNotifications**| プッシュ通知を送信するか。                                  | false    |

### 5. オプション機能（初期状態はオフ）

#### ボラティリティフィルター / 動的スリッページ・ロット調整

| パラメーター                 | 説明                                                         | 初期値  |
|-----------------------------|------------------------------------------------------------|--------|
| **UseVolatilityFilter**     | ATRを使用して市場のボラティリティを判定するか。                        | false  |
| **ATRPeriodForVolatility**  | ATRの計算期間。                                               | 14     |
| **ATRVolatilityThreshold**  | ATRの閾値（例: 0.0020＝約20pips）。                              | 0.0020 |
| **LimitHighVolatility**     | ATRが閾値を超えた場合に取引を回避するか。                           | true   |
| **UseDynamicSlippage**      | ATRに基づきスリッページを動的に調整するか。                           | false  |
| **SlippageATRMultiplier**   | ATRに応じたスリッページ調整の係数。                                | 0.2    |
| **UseDynamicPositionSize**  | ATRが高ボラの場合にロットサイズを縮小するか。                          | false  |
| **VolatilityReductionFactor** | ボラティリティが高い場合に適用するロット縮小率（例: 0.5＝50%）           | 0.5    |

#### ニュースフィルター

| パラメーター          | 説明                                                     | 初期値         |
|----------------------|--------------------------------------------------------|---------------|
| **UseNewsFilter**    | ニュースフィルターを有効にするか。                                 | false         |
| **ImportantNewsTimes** | 重要経済指標発表時刻を「YYYY.MM.DD HH:MM」形式で指定（複数はセミコロン区切り）。 | "2025.12.15 15:30" |
| **PreNewsMinutes**   | 発表前に取引を回避する時間（分）。                                | 30            |
| **PostNewsMinutes**  | 発表後に取引を回避する時間（分）。                                | 30            |

#### マルチタイムフレーム分析

| パラメーター                    | 説明                                                    | 初期値         |
|--------------------------------|-------------------------------------------------------|---------------|
| **UseMultiTimeframeConfirmation** | 複数の時間足でシグナル確認を行うか。                            | false         |
| **MTFPeriod**                  | 補助分析用の時間足（例：H4＝240）。                          | PERIOD_H4     |

#### 強化リスク管理

| パラメーター                   | 説明                                                     | 初期値  |
|-------------------------------|--------------------------------------------------------|--------|
| **UseDailyMaxLossLimit**       | 1日の最大損失額制限を有効にするか。                                | false  |
| **DailyMaxLoss**               | 1日あたりの最大許容損失額。                                   | 100.0  |
| **UseMaxTradeCountPerDay**     | 1日の最大取引回数制限を有効にするか。                              | false  |
| **MaxTradeCountPerDay**        | 1日に許容する最大取引回数。                                   | 5      |
| **UseMaxConsecutiveLosses**    | 連続損失回数の制限を有効にするか。                               | false  |
| **MaxConsecutiveLosses**       | 許容する最大連続損失回数。                                   | 3      |

---

## 使用方法

### 1. 配置

このファイル（README.md）と**EURUSD_Trend_EA_BasicSafe.mq4**を同一ディレクトリ（例：`src/`ディレクトリ）に配置してください。

### 2. コンパイル

1. **MetaEditorを起動**
   MT4のMetaEditorを起動し、**EURUSD_Trend_EA_BasicSafe.mq4**を開いてください。

2. **コンパイル**
   MetaEditor上部の「コンパイル」ボタンをクリックするか、F7キーを押してコンパイルを行います。
   コンパイルに成功すると、エラーや警告が表示されなくなります。

### 3. MT4へのインストール

1. **EAファイルの配置**
   コンパイルが完了したら、生成されたEX4ファイルをMT4のExpertsディレクトリにコピーしてください。
   ※通常、MT4のExpertsディレクトリは「[MT4のデータフォルダー]\MQL4\Experts」にあります。

2. **MT4を再起動**
   MT4プラットフォームを再起動するか、ナビゲーターウィンドウ内で右クリックして「更新」を選択し、EAが表示されることを確認してください。

### 4. MT4での使用

1. **チャートへの適用**
   MT4のナビゲーターから**EURUSD_Trend_EA_BasicSafe**をチャート上にドラッグ＆ドロップします。

2. **パラメーター設定**
   表示されるプロパティウィンドウで、各種パラメーター（トレード設定、時間設定、トレンド判定設定、オプション機能）を必要に応じて調整してください。

3. **EAの起動**
  「OK」をクリックしてEAを開始します。チャート上に「EA起動」等のメッセージが表示されれば、正常に動作しています。

---

## 注意事項

- **通貨ペア**
  本EAは**EURUSD専用**です。他の通貨ペアでの使用は推奨されません。

- **オプション機能**
  ボラティリティフィルター、ニュースフィルター、マルチタイムフレーム分析、強化リスク管理などのオプション機能は、
  初期状態ではオフとなっています。運用前に十分なバックテストおよびフォワードテストを実施し、
  各パラメーターの最適化を行ってください。

- **資金管理**
  リスク管理および資金管理のパラメーターは、実際の口座状況や運用スタイルに合わせて慎重に設定してください。

- **デバッグ**
  `EnableDebugLog`を`true`に設定すると、詳細なログが出力されます。
  デバッグ中はログ内容を確認し、取引条件やパラメーターの調整に活用してください。

- **実運用前の検証**
  本EAを実運用する前に、必ずデモ口座で十分なテストを行ってください。
  とくにオプション機能を有効にする場合は、相場の変動やスプレッドの影響を十分に確認してください。

---

## 開発者

FX自動売買EAプロジェクト
© NiAka

---

このREADMEは、EAの設定、各機能の詳細、MetaEditorでのコンパイル方法からMT4への手動インストールまでを包括的に説明しています。
今後、他のEAも追加される予定ですので、プロジェクト全体の運用基盤としてご利用いただけます。
実運用前に十分なテストを実施し、各パラメーターをお使いの環境に合わせて調整してください。
